"""
WhatsApp Mods APK Scanner
Creato da: Jashin L.
"""

import os
import sys
import argparse
from androguard.misc import AnalyzeAPK

def analyze_apk(apk_path):
    try:
        # Decodifica APK
        os.system(f"apktool d {apk_path} -o decoded_apk")
        
        # Decompila file DEX
        os.system(f"jadx -d decompiled_apk {apk_path}")
        
        # Analizza APK con AndroGuard
        a, d, dx = AnalyzeAPK(apk_path)
        
        # Cerca backdoor e vulnerabilit√†
        findings = []
        
        # Esempio di ricerca di una backdoor
        for method in dx.get_methods():
            if "sendTextMessage" in method.name:
                findings.append(f"Possibile backdoor trovata nel metodo: {method.full_name}")
        
        # Ulteriori controlli di sicurezza
        for string_analysis in dx.get_strings():
            if "http://" in string_analysis or "https://" in string_analysis:
                findings.append(f"URL trovata nelle stringhe: {string_analysis}")
        
        return findings
    except Exception as e:
        print(f"Errore durante l'analisi dell'APK: {e}")
        sys.exit(1)

def main():
    parser = argparse.ArgumentParser(description="WhatsApp Mods APK Scanner")
    parser.add_argument("--apk", required=True, help="Percorso dell'APK da analizzare")
    args = parser.parse_args()
    
    apk_path = args.apk
    if not os.path.isfile(apk_path):
        print(f"Errore: il file {apk_path} non esiste.")
        sys.exit(1)
    
    findings = analyze_apk(apk_path)
    
    if findings:
        print("Trovate le seguenti potenziali minacce:")
        for finding in findings:
            print(f"- {finding}")
    else:
        print("Nessuna minaccia trovata nell'APK.")

if __name__ == "__main__":
    main()